---
---

Now we'll move into some visualization...
what we want is..
we'll accomplish that by first making a new column

## Combine strings

Our data contain both the common and Latin names for the 3 penguin species, in separate column. We want to combine them into one column to use for labeling in a plot. These species names are:

```{r}
pg_df %>% select(common, latin) %>% distinct()
```

===

**glue** is the tidyverse package for pasting data and strings together. Expressions in `{ }` are evaluated as R code. 

```{r, results='hide', handout=0}
library(glue)
```


```{r, results='hide'}
glue("{pg_df$common} ({pg_df$latin})")
```

===

Make species a new column in the data frame using `mutate`

```{r, handout = 0}
pg_df <- pg_df %>% 
  mutate(species = glue("{common} ({latin})"))
```

===

Make a sideways boxplot comparing δ<sup>13</sup>C (‰) across species. Rotate the graph to better display the labels


```{r, handout = 0, message=FALSE, warning=FALSE, fig.height = 3, dpi=100}
pg_df %>% 
  ggplot(aes(x = species, y = delta_13_c_ooo)) +
  geom_boxplot() +
  coord_flip()
```

show axis.title.x = element_text(face = "italic")

===

We will now use markdown syntax within the plot labels to italicize *only* the Latin name part of the label. This functionality will soon be in `ggplot2` but for now install/load from the ggtext package.

```{r, handout = 0}
# devtools::install_github("wilkelab/ggtext")
library(ggtext)
```

===

Remember markdown syntax? 

```{r, handout = 0, message=FALSE, warning=FALSE, fig.height = 3, dpi=100}
pg_df %>% 
  mutate(species = glue("{common} (*{latin}*)")) %>%
  ggplot(aes(x = species, y = delta_13_c_ooo)) +
  geom_boxplot() +
  coord_flip()
```

===

We will also need to specify that this theme element should be interpreted as markdown. Recall that we flipped the X and Y axes! 

```{r, handout = 0, message=FALSE, warning=FALSE, fig.height = 3, dpi=100}
pg_df %>% 
  mutate(species = glue("{common} (*{latin}*)")) %>%
  ggplot(aes(x = species, y = delta_13_c_ooo)) +
  geom_boxplot() + coord_flip() +
  theme(axis.text.y = element_markdown()) 
```

===

The other tags and formatting that can be interpreted are: line break, italics, bold, colors, fonts, super/subscript, and images.

```{r, handout = 0, message=FALSE, warning=FALSE, fig.height = 3, dpi=100}
pg_df %>% 
  mutate(species = glue("{common}<br>(*{latin}*)")) %>%
  ggplot(aes(x = species, y = delta_13_c_ooo)) +
  geom_boxplot() + coord_flip() +
  theme(axis.text.y = element_markdown()) 
```

===

Did you say color??

```{r, handout = 0, message=FALSE, warning=FALSE, fig.height = 3, dpi=100}
pg_df %>% 
  mutate(species = glue("{common}<br><i style='color:#009E73'>({latin})</i>")) %>%
  ggplot(aes(x = species, y = delta_13_c_ooo)) +
  geom_boxplot() + coord_flip() +
  theme(axis.text.y = element_markdown())
```

===

Explore color codes using the `scales` package, which underlies many other functions you may be using in ggplot figures already. 

```{r, handout = 0, message=FALSE}
library(scales)
```
```{r}
show_col(viridis_pal()(3))
```
```{r}
show_col((brewer_pal(type = "qual", palette = "Dark2"))(3))
```

===

In order to use a different color for each penguin species, we will add a new column to the data frame with the color hex code for each using a series of conditional statements with `dplyr`'s `case_when` function. 

```
case_when(LHS ~ RHS, ...)
```

This will create a new vector of Right Hand Side values based on whether cases evaluate to TRUE with the Left Hand Side. Extra cases will either be NA, or add a TRUE ~ "default" as last else. 
{:.notes}

===

Add in the colors we identified from the Dark2 palette in a new column called color. The LHS is the conditional statement to filer rows and the RHS is the replacement value, in this case the color hex code.

```{r, handout = 0}
pg_df <- pg_df %>%
  mutate(color = case_when(common == "Gentoo penguin" ~ "#1B9E77",
                           common == "Chinstrap penguin" ~ "#D95F02",
                           common == "Adelie Penguin" ~ "#7570B3"))
```

If there were rows with other or NA values for the common name, we could designate what goes in the color column for those rows by adding another conditional such as `TRUE ~ "#000000"`.
{:.notes}

===

Then use glue to include the value from the `color` column in the species label.

```{r, message = FALSE, handout=0, warning=FALSE, fig.height = 3, dpi=100}
pg_df %>% 
  mutate(species = glue("{common}<br><i style='color:{color}'>({latin})</i>")) %>%
  ggplot(aes(x = species, y = delta_13_c_ooo)) +
  geom_boxplot() + coord_flip() +
  theme(axis.text.y = element_markdown())
```


